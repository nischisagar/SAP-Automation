---
- name: Playbook to delete 90 days old Oracle Audit files
  hosts: "{{ hname1 }}"
  become: yes
  become_method: sudo
  gather_facts: False
  vars: 
    ansible_python_interpreter: "/usr/bin/python"
  tasks:
    - name: Check count of audit files
      shell: |
        #!/bin/ksh
        alist=`df -g|grep -i oracle|grep -i audit|awk '{print $NF}'`
        for i in $alist
        do
        df -g $i|tail -1|awk '{print "$i " "Beforefree_space: " $3, "Used_%: " $4}'
        find $i -type f -name '*.aud' -mtime +90 -exec rm {} \;
        df -g $i|tail -1|awk '{print "$i " "Afterfree_space: " $3, "Used_%: " $4}'
        done
      register: audit_count

    - name: Demo set_facts final output
      set_fact:
        audit_count: "{{ audit_count['stdout'] }}"
      
    - debug:
        msg: "{{ audit_count }}"    
