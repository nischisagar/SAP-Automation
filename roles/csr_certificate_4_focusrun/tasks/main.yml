---
- name: Getting current host info
  shell: hostname
  register: hname

- debug:
    msg: "{{ hname }}"

- name: Setting facts - hname
  set_fact:
    hname: "{{ hname['stdout'] }}"

- debug:
    msg: "{{ hname }}"

- name: "Find FQDN"
  shell: |
    ip1=`ping -c 1 {{ hname }}|grep from|cut -d: -f1|cut -dm -f2`
    wfqdn=`nslookup $ip1|grep -i "name ="|tail -1|awk '{print $4}'|sed 's/.$//'`
    echo $wfqdn
  register: fqdnh

- debug:
    msg: "{{ fqdnh }}"

- name: Setting facts - fqdnh
  set_fact:
    fqdnh: "{{ fqdnh['stdout'] }}"

- debug:
    msg: "{{ fqdnh }}"

- name: "Generate CSR Using openssl"
  shell: |
    cd {{ install_path }};
    cd {{ install_path }};openssl genrsa -des3 -out {{ install_path }}/{{ keyname }} -passout pass:{{ password1 }} 2048
    cat {{ install_path }}/{{ keyname }}
  register: csroutput

- debug:
    msg: "{{ csroutput }}"

- name: "Process Input param file"
  template:
    src: "{{ role_path }}/templates/{{ item }}"
    dest: "{{ install_path }}/"
    owner: root
    group: system
    mode: '0777'
  with_items:
  - FRUN_configuration_file.conf
  register: copyconffile

- debug:
    msg: "{{ copyconffile }}"

- name: "Create CSR from key file and conf"
  shell: |
    cd {{ install_path }};
    openssl req -new -key {{ install_path }}/{{ keyname }} -passin pass:{{ password1 }} -config {{ install_path }}/FRUN_configuration_file.conf -out {{ install_path }}/{{ cername }}
    cat {{ install_path }}/{{ cername }}
  register: csroutput1

- debug:
    msg: "{{ csroutput1 }}"