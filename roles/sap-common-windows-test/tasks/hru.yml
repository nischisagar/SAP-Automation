---
- name: Collect SAP CRYPTO Version
  block:
    - name: Get the SID
      win_shell: |
        $Service=get-wmiobject win32_service |?{$_.Name -like '*SAP???_??*' -and $_.pathname -match 'D00|DVE|SCS' -and $_.state -eq "Running"}
        $sub_service=(($service.Name).Substring(3)).split("_")
        $sub_service[0,2,4,6,8]
      register: sid
      ignore_errors: true

    - name: Dispaly the SIDadm user details
      debug:
        msg: "{{ sid.stdout | trim |lower }}adm"
      with_items: "{{ sid }}"

    - name: Set facts sid adm as variables to become as sidam when stop SAP
      set_fact:
        sid_adm: "{{ sid.stdout | trim |lower }}adm"

    - name: restore output
      win_shell:  |
        echo "{{ sid_adm }}" >> C:\temp\sidlisttest.txt
      

    

