---
- name: Set the nfs_use_reserved_ports value as 1
  command: "nfso -p -o nfs_use_reserved_ports=1"
  register: nfs_use_reserved_ports
  args:
        warn: false
  
- name: Create the NFS share /tempfs_ansible entries in /etc/filesystems
  aix_filesystem:
    device: /data/REAR/bigfix
    nfs_server: ampsv010bld0d.p1.saint-gobain.net
    filesystem: /tempfs_ansible
    state: present

- name: Mount the NFS file system /tempfs_ansible
  aix_filesystem:
    filesystem: /tempfs_ansible
    state: mounted

- name: Get the SAP Details
  shell: "su - {{ sap_sid_adm_usr }} -c {{ check_sap_command }}"
  register: check_sap_details
  changed_when: False
  
  - debug:
    msg: "{{ check_sap_details.stdout_lines }}"
  
- name: Unmount the NFS share /tempfs_ansible
  aix_filesystem:
    filesystem: /tempfs_ansible
    rm_mount_point: yes
    state: unmounted

- name: Remove the NFS share /tempfs_ansible entries from /etc/filesystems
  aix_filesystem:
    device: /data/REAR/bigfix
    nfs_server: ampsv010bld0d.p1.saint-gobain.net
    filesystem: /tempfs_ansible
    state: absent

- name: Set the nfs_use_reserved_ports value as 0
  command: "nfso -p -o nfs_use_reserved_ports=0"
  when: nfs_use_reserved_ports.changed