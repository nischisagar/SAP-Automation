---
- name: "Rename existing input file in target location"
  shell: |
    cnt=`ls -lrt /010_SHARED_INFRA/SAP_Installaion/iniparamfiles/inifile_ci_BSERP6EHP8.params|wc -l`
    if [ $cnt -eq 1 ]
    then 
    mv /010_SHARED_INFRA/SAP_Installaion/iniparamfiles/inifile_ci_BSERP6EHP8.params /010_SHARED_INFRA/SAP_Installaion/iniparamfiles/inifile_ci_BSERP6EHP8.params_`date +%d%m%M`
    else
    echo "No mentioned input file found"
    fi
  register: renameinputfile

- debug:
    msg: "{{ renameinputfile }}"

- name: "Process Input param file"
  template:
    src: "{{ role_path }}/templates/{{ item }}"
    dest: "/010_SHARED_INFRA/SAP_Installaion/iniparamfiles/"
    owner: root
    group: sapinst
    mode: '0777'
  with_items:
  - inifile_ci_BSERP6EHP8.params
  register: inputfile

- debug:
    msg: "{{ inputfile }}"

- name: "Create Installation Directory SWPM"
  file:
    path: "{{ install_path }}"
    state: directory
    owner: root
    group: sapinst
    mode: '0777'
  register: pathcreate

- debug:
    msg: "{{ pathcreate }}"

- name: "Execute installation step"
  shell: |
    cd {{ install_path }};
    cd {{ swpm_path }};/010_SHARED_INFRA/SAP_Installaion/SWPM10SP33_aix_hana/sapinst SAPINST_INPUT_PARAMETERS_URL=/010_SHARED_INFRA/Ansible_Hana_files/inifile.params_qxw SAPINST_EXECUTE_PRODUCT_ID=NW_ABAP_OneHost:NW750.HDB.ABAP SAPINST_SKIP_DIALOGS=true
  register: install_out

- debug:
    msg: "{{ install_out }}"