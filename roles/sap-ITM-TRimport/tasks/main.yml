---
# tasks file for ITM Agent update

- name: ITM Agent Update
  set_fact:
    patchpath: /tmp

- debug:
    msg: "{{ patchpath }}"

- name: Check free space for tmp, atleast 1 GB free space should be there
  shell: df -m {{ patchpath }}|tail -1|awk '{print $3}'|awk '{print int($0)}'
  register: tmpfree
  ignore_errors: yes

- debug:
    msg: "{{ tmpfree }}"

- name: Register temp free space value
  set_fact:
    tmpfree: "{{ tmpfree['stdout'] }}"
  ignore_errors: yes

- debug:
    msg: "tmpfree: {{ tmpfree }}"

- name: Copy Transport requests to patchlocation
  copy:
    src:  ./files/K711_00142_DELETE.ITM
    dest: "{{ patchpath }}/"
    owner: root     
    group: sapsys
    mode: '0775'
  register: tpmovestatus
  when: (tmpfree | int) >= (300 | int)

- debug:
    msg: "{{ tpmovestatus }}"

