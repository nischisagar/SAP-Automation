---
- name: collect the version of SAP
  win_shell: sqlcmd -S {{ inventory_hostname }} -U {{ user_name }} -P {{ user_password }} -d {{ sid_mssql }} -Q "select distinct STEXT from {{ sid_mssql|lower }}.CVERS_TXT where LANGU='E';" |select-string -pattern SAP
  register: sap_verison
- debug:
    msg: "{{ sap_verison.stdout }}"
- name: collect the version of DB
  win_shell: sqlcmd -S {{ inventory_hostname }} -U {{ user_name }} -P {{ user_password }} -d {{ sid_mssql }} -Q "select @@version;" |Select-String -Pattern SQL
  register: db_verison
- debug:
    msg: "{{ db_verison.stdout }}"    
- name: collect the version of Kernel
  win_shell: sqlcmd -S {{ inventory_hostname }} -U {{ user_name }} -P {{ user_password }} -d {{ sid_mssql }} -Q "select  top 1 SAPRELEASE,substring(PATCHNO, patindex('%[^0]%',PATCHNO), 10) ,TIMESTAMP from {{ sid_mssql|lower }}.PATCHHIST where EXECUTABLE='disp+work' order by 3 desc"
  register: kernal_verison
- debug:
    msg: "{{ kernal_verison.stdout_lines[2] }}"
