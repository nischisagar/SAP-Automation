---
#- name: Copy the script
#  copy:
#    src: "{{ sap_version_check_script_source }}"
#    dest: "/tmp/{{ item.name }}-{{ sap_version_check_script }}"
#    owner: "{{  item.name }}"
#    mode: '0700'
#  when: sid_adm_usr_oradb is defined
#  loop: "{{ sid_adm_usr_oradb }}"

#- name: Run the SAP version check script
#  shell: "su - {{ item.name }} -c /tmp/{{ item.name }}-{{ sap_version_check_script }}"
#  changed_when: False
#  args:
#    warn: false
#  when: sid_adm_usr_oradb is defined
#  loop: "{{ sid_adm_usr_oradb }}"

- name: Get the SID
  shell: "cat /tmp/{{ item.name }}-{{ sap_version_check_log }} | head -1"
  loop: "{{ sid_adm_usr_oradb }}"
  register: "get_sid_output"
  
- name: Debug the output get_sid_output
  debug: 
    msg: "{{ item.stdout }}"
  loop: "{{ get_sid_output.results | list }}"

#- name: Get the SAP Version
#  shell: "cat /tmp/{{ item.name }}-{{ sap_version_check_log }}  | head -2 | tail -1"
#  loop: "{{ sid_adm_usr_oradb }}"
#  register: "get_sap_version_output"
  
#- name: Debug the output get_sid_output
#  debug:
#    msg: "{{ item.stdout }}"
#  loop: "{{ get_sap_version_output.results }}"
#  loop_control:
#    loop_var: ansible_loop_var
  
#- name: Get the Kernel make variant
#  shell: "cat /tmp/{{ item.name }}-{{ sap_version_check_log }}  | head -3 | tail -1 | awk '{print $NF}'"
#  register: "get_kernel_make_variant_output"
#  loop: "{{ sid_adm_usr_oradb }}"

#- name: Get the Kernel make variant
#  shell: "cat /tmp/{{ item.name }}-{{ sap_version_check_log }}  | head -4 | tail -1 | awk '{print $NF}'"
#  register: "get_patch_number_output"
#  loop: "{{ sid_adm_usr_oradb }}"

#- name: Get the DB name
#  shell: "cat /tmp/{{ item.name }}-{{ sap_version_check_log }}  | head -5 | tail -1"
#  register: "get_db_name_output"
#  loop: "{{ sid_adm_usr_oradb }}"

#- name: Get the DB Version
#  shell: "cat /tmp/{{ item.name }}-{{ sap_version_check_log }}  | tail -1 | awk '{print $NF}'"
#  register: "get_db_version_output"
#  loop: "{{ sid_adm_usr_oradb }}"

#- name: Remove the script
#  file:
#    path: "/tmp/{{ item.name }}-{{ sap_version_check_script }}"
#    state: absent
#loop: "{{ sid_adm_usr_oradb }}"

#- name: Remove the log
#  file:
#    path: "/tmp/{{ item.name }}-{{ sap_version_check_log }}"
#    state: absent
#  loop: "{{ sid_adm_usr_oradb }}"


# - name: Add the server details in to the SAP Report File.
#  lineinfile:
#    dest: "{{ report_file }}"
  #  line: "{{ entity_name }},{{ ansible_fqdn }},{{ get_sid_output.stdout }},{{ ansible_distribution }},{{ ansible_distribution_version }},{{ansible_default_ipv4.address }},{{ get_sap_version_output.stdout }},{{ get_kernel_make_variant_output.stdout }},{{ get_patch_number_output.stdout }},{{ get_db_name_output.stdout }},{{ get_db_version_output.stdout}}"
#    line: "{{ entity_name }},{{ ansible_fqdn }},{{ var=get_sid.item.stdout }},{{ ansible_distribution_version }},{{ansible_default_ipv4.address }},{{ get_sap.item.stdout }}"
#  loop: 
#    - get_sid: "{{ get_sid_output.results }}"
#      get_sap: "{{ get_sap_version_output.results }}"
#  delegate_to: ampsv010bld0d.ux1.ibmfr.bluecare.ibm.com

