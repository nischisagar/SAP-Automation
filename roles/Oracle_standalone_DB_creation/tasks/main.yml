---
# tasks file for oracle_home_installation

- name: "Update ENV to oracle user and create control file path:"
  shell: |
    echo "export ORACLE_SID={{ dbname }}" >> /home/oracle/.profile
    echo "export ORACLE_HOME={{ oracle_home_value }}" >> /home/oracle/.profile
    echo "export ORACLE_BASE={{ oracle_base_value }}" >> /home/oracle/.profile
    echo "export PATH={{ oracle_home_value }}/bin:$PATH" >> /home/oracle/.profile
    mkdir -p {{ control_file_path }}
    chown oracle:{{ db_group_name }} {{ control_file_path }}
  register: updateenv

- debug:
    msg: "{{ updateenv }}"

- name: "Process Oracle initfile Template"
  template:
    src: "{{ role_path }}/templates/db_install.rsp"
    dest: "/tmp/db_install.rsp"
  register: cftemplate

- debug:
    msg: "{{ cftemplate }}"

- name: "Replacing db response file"
  shell: |
    #mv {{ oracle_home_value }}/install/response/db_install.rsp {{ oracle_home_value }}/install/response/db_install.rsp_`date +%d%h%y`
    #cp -rp /tmp/db_install.rsp {{ oracle_home_value }}/install/response/
    #chown oracle:{{ db_group_name }} {{ oracle_home_value }}/install/response/db_install.rsp
    #chmod 775 {{ oracle_home_value }}/install/response/db_install.rsp
  register: dbresponse

- debug:
    msg: "{{ dbresponse }}"

- name: "Proceeding with Home Installation"
  shell: |
    su - oracle -c "{{ oracle_home_value }}/runInstaller -silent -ignorePrereq -waitforcompletion -responseFile {{ oracle_home_value }}/install/response/db_install.rsp < /tmp/input.txt"
  register: homeinstall

- debug:
    msg: "{{ homeinstall }}"