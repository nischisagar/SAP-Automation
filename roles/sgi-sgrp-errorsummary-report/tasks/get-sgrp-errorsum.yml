---
- name: Extract SGRP Error summary
  win_shell: |
    $filepath1 = "C:\CheckSAP\HTMLReports.sav"
    $filepath2 = "C:\CheckSAP\sgrperrtemp"
    $da = Get-Date -UFormat "%Y-%m-%d"
    Get-Content "$filepath2\template.html" > $filepath2\sgrpoutputfile.html
    Get-ChildItem $filepath1 *$da*.html |
    ForEach-Object{
    $fileName = $_.Name
    echo $filename
    Get-Content "$filepath1\$filename" -head 26 > $filepath2\tempfile1.html
    $val = Get-Content "$filepath2\tempfile1.html" -tail 7 
    echo $val >> $filepath2\sgrpoutputfile.html
    cd $filepath1
    copy $filename 1.html
    Select-String -Pattern "#FF0000" -Path "1.html" -Context 3,3 > $filepath2\errorout.txt
    $content = Get-Content "$filepath2\errorout.txt"
    ForEach ($item in $content) {
    Write-Output $item
    Write-Output $item | ForEach-Object { $_.split(":")[2] } >> $filepath2\sgrpoutputfile.html
    }
    }
  register: sgrp_report

- debug:
    msg: "{{ sgrp_report.stdout_lines }}"